var isCustomize=(window.location.href.indexOf("safe.tumblr.com")>=0)?true:false;var disqusEnabled=(typeof disqusEnabled==="undefined")?false:true;var lteIE8=$("html").is(".lte-ie8")?true:false;var showFollowing=(typeof showFollowing==="undefined")?false:true;var showTweets=(typeof showTweets==="undefined")?false:true;var showTwitterProfile=(typeof showTwitterProfile==="undefined")?false:true;var isPermalink=(typeof isPermalink==="undefined")?false:true;var collapseNotes=(typeof collapseNotes==="undefined")?false:true;var fixedBar=(typeof fixedBar==="undefined")?false:true;var followedRows=(typeof followedRows==="undefined")?3:followedRows;var tumblrPhotosets=(typeof tumblrPhotosets==="undefined")?false:true;var infiniteScroll=(typeof infiniteScroll==="undefined")?false:true;var IOS=(navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod")?true:false;var twitterJSLoading=false;var fancyboxArgs={type:"image",padding:0,overlayColor:"#000",overlayOpacity:0.85,titlePosition:"outside",titleFormat:function(a){return a}};var sliderArgs={container:"slides",autoHeight:true,generatePagination:false,effect:"slide"};(function(f){f(document).ready(function(){i();var q=f("#header");if(IOS){fixedBar=false}if(fixedBar){var n=false,m=false;var l=750;var o=false;var k=true;var p=f(window).scrollTop();if(p>l){o=true;k=false;q.removeClass("pinned").addClass("fixed").css({top:"0px"}).find(".shadow").show()}}if(showFollowing){c()}if(showTweets&&twitterUsername!==""){a()}if(isPermalink){e()}if(disqusEnabled){j()}if(searchValue!==""){f("#search-form").find("input").val(searchValue).focus(function(){if(f(this).val()==searchValue){f(this).val("")}}).blur(function(){if(f(this).val()==""){f(this).val(searchValue)}})}f(".share-btn").live("click",function(u){u.preventDefault();f(".share-box:not(this)").hide();var t=f(this).attr("data-permalink");var w=f(this).next(".share-box");var v=w.find(".like-button");var s=w.find(".plusone-btn");w.show().find(".shortlink").focus();if(s.length>0){var r=f(this).closest(".post").attr("id");gapi.plusone.go(r)}if(v.length>0){v.replaceWith('<iframe class="facebook-like-button" src="http://www.facebook.com/plugins/like.php?href='+t+'&amp;layout=button_count&amp;show_faces=false&amp;width=90&amp;action=like&amp;colorscheme=light&amp;height=20" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:20px;" allowTransparency="true"></iframe>')}});f(document).mousedown(function(r){if(!f(r.target).parents(".share-box").get(0)){f(".share-box").hide()}});f(".shortlink").live("click",function(){f(this).focus().select()});f(".photo-panel").live("mouseenter",function(){f(this).find(".photo-btns").stop(true,true).fadeIn(150)}).live("mouseleave",function(){f(this).find(".photo-btns").stop(true,true).fadeOut(150)});f(".type-photoset").find(".photo-panel").find("a.lightbox").live("click",function(){f(this).parent().prev("a:has(img)").click();return false});f(window).scroll(function(){if(fixedBar){p=f(window).scrollTop();if(p>l){if(!o){if(m!==false){clearTimeout(m);clearTimeout(n)}o=true;k=false;m=setTimeout(function(){q.stop(true,true).removeClass("pinned").addClass("fixed").css({top:"-50px"}).animate({top:"0px"},300).find(".shadow").show()},100)}}else{if(p<l){if(!k){if(n!==false){clearTimeout(m);clearTimeout(n)}o=false;k=true;n=setTimeout(function(){q.stop(true,true).animate({top:"-60px"},300,function(){f(this).hide().css({top:"30px"}).find(".shadow").hide().end().removeClass("fixed").addClass("pinned").fadeIn("fast")})},100)}}}}});if((window.location.href.indexOf("/page/")>-1)||IOS){infiniteScroll=false;f("body").removeClass("infscroll")}if(infiniteScroll&&!isPermalink){f("#content").infinitescroll({navSelector:"#pagination",nextSelector:"#pagination a.next",itemSelector:".post",loadingImg:"http://static.tumblr.com/xgwqnql/iLQleupcf/infscroll_loader.gif",loadingText:"",donetext:"No more posts to load."},function(s,r){f(s).eq(0).before('<div class="page-sep">Page '+r+"</div>");i(f(s),true);if(disqusEnabled){j()}})}});function i(k,l){var m=k?k:f(".post:not(.loaded)");m.each(function(){var C=f(this);var r=C.attr("id").split("-")[1];if(C.hasClass("type-photo")){g(C)}if(C.hasClass("type-photoset")){if(tumblrPhotosets){if(contentWidth>500){h(C);var x=f("#photoset_"+r).html().replace(/\/500"/,"/"+contentWidth+'"');f("#photoset_"+r).html(x)}C.find(".media").removeClass("loading")}else{d(C)}}if(C.hasClass("type-audio")){if(!IOS){if(l){var v=C.find(".player-btn").css("visibility","hidden");var t=C.find(".js-string").html();var A=/\\x3cembed.+\\x3c\/embed\\x3e/;var y=t.match(A)[0].replace(/\\x3cembed/,"\x3cembed wmode=\x22opaque\x22");v.append('<script type="text/javascript">replaceIfFlash(9,"audio_player_'+r+"\",'\x3cdiv class=\x22audio_player\x22\x3e"+y+"\x3c/div\x3e')<\/script>").css("visibility","visible");C.find(".js-string").remove()}else{var B=C.find(".audio_player");var u=B.html();var D=u.replace(/<embed\s/i,"<embed wmode='opaque' ");B.html(D);C.find(".js-string").remove()}}}if(C.hasClass("type-video")){if(l){var s=C.find(".media");if(/span id="?video_player/i.test(s.html())){var t=C.find(".js-string").html();var p=t.split("x22video_player_"+r+"\\x22,")[1].replace(/\\'/g,"'").replace(/\\\\x26/g,"\x26").replace(/'\)\\x3c\/script\\x3e'/,"");s.append('<script type="text/javascript">renderVideo("video_player_'+r+'", '+p+"')<\/script>")}}h(C)}if(C.hasClass("type-quote")){var o=C.find(".quote-text");var z=o.find(":first-child");var q=o.find(":last-child");var w='<span class="ldquo">&ldquo;</span>';var n='<span class="rdquo">&rdquo;</span>';if((z.length>0)&&z.is("p")){z.prepend(w)}else{o.prepend(w)}if((q.length>0)&&(/<\/[a-zA-Z]+>$/.test(o.html()))){q.append(n)}else{o.append(n)}}C.addClass("loaded")});if(!twitterJSLoading){b()}}function d(s){var o,r;var l=s.attr("id").split("-")[1];var m=(s.hasClass("tag_masonify")&&contentWidth>500)?true:false;var n=s.find(".media");var p={animationStart:function(){f("#photoset-"+l+" .caption").animate({height:"0"},200)},animationComplete:function(){f("#photoset-"+l+" .caption").animate({height:"40px"},200)}};var q=function(){n.removeClass("loading")};f.ajax({url:"/api/read/json?id="+l+"&callback=?",type:"get",dataType:"json",statusCode:{401:function(){alert("401")}},success:function(t){if(!t.posts){q();return}k(t)},error:q});f.each(s.find(".tag-list").find("li"),function(t){if(/masonify/i.test(f(this).text())){f(this).hide()}});function k(z){var B="{{#posts}}{{#photos}}";B+='<div class="{{get_panel_class this}}"><a class="photo" href="{{high_res_url this}}" title="{{get_caption this}}" rel="gallery-{{../id}}"></a>';B+="{{> buttons }}"+((!m)?"{{{div_caption this}}}":"")+"</div>";B+="{{/photos}}{{save_images this}}{{/posts}}";var D=Handlebars.compile(B);var u=f('<div id="photoset-'+l+'" class="'+((m)?"bricks":"slides")+'"></div>');n.html(u.append(D(z))).find(".photo-panel a[rel^=gallery]").fancybox(fancyboxArgs);var C=n.data("gallery");var x=0;var v=f("#photoset-"+l);for(var A=0,w=C.length;A<w;A++){var y=new Image();var t=C[A].src;f(y).data("loaded",false).attr("src",t).appendTo(v.find(".photo-panel:nth-child("+(A+1)+") .photo")).load(function(){f(this).data("loaded",true);x+=1;if(x==C.length){if(m){v.doMasonry().parent().removeClass("loading")}else{n.append('<div class="navi"><a href="#" class="prev"><span>Previous</span></a><a href="#" class="next"><span>Next</span></a></div>').slides(f.extend(sliderArgs,p)).removeClass("loading")}}}).error(function(){f(this).hide().after('<img src="http://static.tumblr.com/njty47g/7vOlf3ism/image_fail.gif" alt="Sorry, there was a problem loading this image. Please check your photoset."/>').parent().next(".photo-btns").remove();f(this).trigger("load")}).each(function(){if(lteIE8&&this.complete&&!f(this).data("loaded")){f(this).trigger("load")}})}}}function g(m){var k=m.find(".photo-panel");var l=k.find("img");var o=k.find(".lightbox");var n=l.parent("a");l.addClass("shadowed");o.fancybox(fancyboxArgs);if(n.length>0){if(n.attr("href")==o.attr("href")){n.click(function(){o.click();return false})}else{f("<a>",{"class":"photo-link-url",href:n.attr("href"),text:"Go to Link"}).prependTo(k.find(".photo-btns"));if(o.length>0){n.click(function(){o.click();return false})}}}}function h(v){function u(w,E){if(E=="css"){var D=((w.css("width")=="100%")?q:parseInt(w.css("width")))/parseInt(w.css("height"))}else{if(E=="attr"){var D=((w.attr("width")=="100%")?q:parseInt(w.attr("width")))/parseInt(w.attr("height"))}}return Math.round(q/D)}v.find(".js-string").remove();var q=contentWidth;var o=v.find(".media");var k=o.find("embed");var C=o.find("object");var p=o.find("iframe");var t=o.html();var n=/src="?http(s)?:\/\/(www)?.youtube(-nocookie)?.com/i.test(t);var z=/src="?http:\/\/player\.vimeo\.com/i.test(t);if(n){if(p.length>0){var l=p.attr("src").match(/http:\/\/(www)?.youtube.com\/([a-zA-Z0-9\/\-_])+((?=&amp;|&))?/)[0];o.html('<iframe class="youtube-player" src="'+l+'?rel=0&hd=1&wmode=opaque" width="'+q+'" height="'+u(p,"attr")+'" frameborder="0" type="text/html"></iframe>')}else{if(!(/wmode="?(opaque|transparent)/gi.test(t))){t=t.replace(/<embed/i,'<param name="wmode" value="opaque" /><embed wmode="opaque"')}if(t.indexOf("version=")>=0){var r=30}else{var r=25;var s=/rel=0([a-zA-Z0-9-_&=;\/])+(?="?)/gi;var B="rel=0&color1=0xFFFFFF&color2=0xFFFFFF&showinfo=0&egm=0&"+((contentWidth>500)?"hd=1":"hd=0");t=t.replace(s,B)}var l=t.match(/http(s)?:\/\/(www)?.youtube(-nocookie)?.com\/([a-zA-Z0-9\/\-_])+/i)[0];var y=l.match(/\/([ev]|embed)\/([a-zA-Z0-9\/\-_]+)/);var m=Math.floor(q*0.75+r);var A=Math.floor(q*0.5625+r);f.getJSON("http://gdata.youtube.com/feeds/api/videos/"+y[2]+"?v=2&alt=json-in-script&callback=?",function(w){oldWidth=/width="?([0-9]*)"?/g;newWidth='width="'+q+'"';oldHeight=/height="?([0-9]*)"?/g;if(w.entry.media$group.yt$aspectRatio!=null){u='height="'+A+'"'}else{u='height="'+m+'"'}t=t.replace(oldHeight,u);t=t.replace(oldWidth,newWidth);o.html(t)})}}else{if(z){o.html('<iframe src="'+p.attr("src")+"?title=0&byline=0&portrait=0&color="+themeColor.replace("#","")+'" width="'+q+'" height="'+u(p,"attr")+'" frameborder="0"></iframe>')}else{if(p.length>0){var x=u(p,"attr");p.attr("width",q).attr("height",x).css("width",q).css("height",x)}else{if(k.length>0){var x=u(k,"css");k.attr("wmode","opaque").wrap("<div></div>");k.css("width",q).css("height",x);k.parent().css("width",q).css("height",x);if(k.parent().parent().is("object")){k.parent().parent().css("width",q).css("height",x)}}else{if(C.length>0&&C.not(":has(embed)")){if(!f.support.htmlSerialize){C.replaceWith(C.attr("altHtml"));var k=o.find("embed");var x=u(k,"css");k.css("width",q).css("height",x);k.attr("wmode","opaque")}else{var x=u(C,"attr");C.css("width",q).css("height",x).attr("width",q).attr("height",x)}}}}}}o.removeClass("loading")}function e(){var m=300;var k=f("ol.notes");var l=f("#notes-toggle");l.toggle(function(){k.slideUp(m*1.5);f(this).find(".label").text("Show").next("span").removeClass("up")},function(){k.slideDown(m*1.5);f(this).find(".label").text("Hide").next("span").addClass("up")});if(collapseNotes&&(window.location.href.indexOf("#notes")==-1)){l.click()}f("#content").find(".meta-list").find("li.notes a").click(function(n){n.preventDefault();if(f("#notes").find("ol.notes").is(":not(:visible)")){l.click()}})}function c(){var n=f("#followed");var p=n.find("#followed-list");var o=p.children("li").size();n.find("h2").append(" <span>("+o+")</span>");if(o<=(followedRows*5)){return true}var m=n.find("#followed-wrap");var k=followedRows*p.find("li").eq(0).outerHeight(true);var l=m.outerHeight(true);m.css("height",k+"px");f("<a>",{"class":"show-more-followed",href:"#",html:"Show All &darr;"}).appendTo(n).toggle(function(){m.css({height:l+"px"});f(this).html("Show Less &uarr;")},function(){m.css({height:k+"px"});f(this).html("Show All &darr;")})}function j(){var l="?";var k=f("li.comments a");k.each(function(m){if(f(this).attr("href").indexOf("#disqus_thread")>=0){l+="url"+m+"="+encodeURIComponent(this.href)+"&"}});f.getScript("http://disqus.com/forums/"+disqusShortname+"/get_num_replies.js"+l,function(){k.each(function(m){f(this).prepend('<span class="icon"></span>').parent().removeClass("hidden")})})}function b(){twitterJSLoading=true;f.ajax({url:"http://platform.twitter.com/widgets.js",dataType:"script",cache:true,success:function(){twitterJSLoading=false}})}function a(){f.ajax({url:"https://api.twitter.com/1/statuses/user_timeline.json?screen_name="+twitterUsername+"&count=4&include_rts=true&callback=recent_tweets",dataType:"script",cache:true})}f.fn.doMasonry=function(){var k=contentWidth/2;f(this).masonry({columnWidth:k});return this};Handlebars.registerPartial("buttons",'<div class="photo-btns"><a class="lightbox" href="#">Pop-up</a><a class="photo-url" href="{{high_res_url this}}">View Separately</a></div>');Handlebars.registerHelper("high_res_url",function(k){return k["photo-url-1280"]});Handlebars.registerHelper("get_panel_class",function(k){return(k.caption.indexOf("2col")>=0)?"photo-panel span2col":"photo-panel"});Handlebars.registerHelper("get_caption",function(k){return k.caption.replace(/\s?2col:?\s?/,"")});Handlebars.registerHelper("div_caption",function(l){var k=l.caption.replace(/\s?2col:?\s?/,"");return(k.length>0)?'<div class="caption">'+k+"</div>":""});Handlebars.registerHelper("save_images",function(n){var v=[];var m=n.id;var x=n.photos;var o=f("#post-"+m).hasClass("tag_masonify")?true:false;var q=f("#post-"+m+" .media");for(var w=0,u=x.length;w<u;w++){var k;var l=x[w];var r=l["photo-url-1280"];var s=l["photo-url-500"];var t=l.caption.indexOf("2col")>=0?true:false;if(contentWidth>500){if(o){k=t?r:s}else{k=r}}else{k=s}v.push({src:k})}q.data("gallery",v)});f.preloadImages=function(){for(var k=0;k<arguments.length;k++){img=new Image();img.src=arguments[k]}};f.preloadImages("http://static.tumblr.com/xgwqnql/fMLlbpj9t/header_shadow.png","http://static.tumblr.com/njty47g/Omoleufdi/topbar_bg.png","http://static.tumblr.com/njty47g/x1Ild1iih/photo_btns_med.png")})(window.jQuery);function recent_tweets(g){numTweets=(numTweets>4)?4:numTweets;Handlebars.registerHelper("tweet_text",function(a){return linkifyTweet(a.text)});Handlebars.registerHelper("timeago",function(a){return relative_time(a.created_at)});Handlebars.registerHelper("tweet_permalink",function(a){return"http://www.twitter.com/"+twitterUsername+"/status/"+a.id_str});var d='{{#each this}}<li><p class="tweet">{{{tweet_text this}}} <span class="tweet-meta"><a class="timestamp" href="{{tweet_permalink this}}" time="{{created_at}}" target="_blank">{{timeago this}}</a> &bull; <a class="reply" href="http://twitter.com/?status=@'+twitterUsername+"%20&in_reply_to_status_id={{{id_str}}}&in_reply_to="+twitterUsername+'" target="_blank">Reply</a></span></p></li>{{/each}}';var f=Handlebars.compile(d);if(typeof g!=="undefined"&&g.length>0){jQuery("#twitter .loading-text").replaceWith('<ul class="tweets">'+f(g.slice(0,numTweets))+"</ul>");if(showTwitterProfile){var b=g[0]["user"];var c=b.description;var e='<div class="profile"><h3><a href="http://www.twitter.com/'+twitterUsername+'">@'+twitterUsername+'</a><br/> <span class="name">'+b.name+"</span></h3>";e+=(c)?'<p class="bio">'+c+"</p></div>":"";jQuery("#twitter .tweets").before(e)}}else{if(g.length==0){jQuery("#twitter .loading-text").html('Error fetching tweets for username: <a href="http://www.twitter.com/'+twitterUsername+'">@'+twitterUsername+"</a>")}}}function linkifyTweet(a){return a.replace(/((ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?)/gi,'<a href="$1">$1</a>').replace(/(^|\s)#(\w+)/g,'$1<a href="http://search.twitter.com/search?q=%23$2">#$2</a>').replace(/(^|\s)@(\w+)/g,'$1<a href="http://twitter.com/$2">@$2</a>')}function relative_time(b){var a=parseDate(b);var c=(arguments.length>1)?arguments[1]:new Date();var d=parseInt((c.getTime()-a)/1000);if(d<60){return"less than a minute ago"}else{if(d<120){return"about a minute ago"}else{if(d<(45*60)){return(parseInt(d/60)).toString()+" minutes ago"}else{if(d<(90*60)){return"about an hour ago"}else{if(d<(24*60*60)){return"about "+(parseInt(d/3600)).toString()+" hours ago"}else{if(d<(48*60*60)){return"1 day ago"}else{return(parseInt(d/86400)).toString()+" days ago"}}}}}}}function parseDate(d){var a=d.split(" "),b,c;if(/\+0000/.test(a[5])){b=a[3];c=a[4]}else{b=a[5];c=a[3]}return new Date(Date.parse(a[1]+" "+a[2]+", "+b+" "+c+" UTC"))}window.log=function(){log.history=log.history||[];log.history.push(arguments);if(this.console){console.log(Array.prototype.slice.call(arguments))}};